<%# Category Block with Tabs %>
<section class="container mx-auto px-4 py-12 mb-12">
  <div class="flex items-center justify-between mb-6">
    <h2 class="text-3xl font-bold"><%= category.name.upcase %></h2>
    <%= link_to "Xem tất cả", products_path(category_slug: category.slug), class: "text-blue-600 hover:text-blue-800 font-semibold" %>
  </div>

  <%# Tabs for subcategories %>
  <% if subcategories.any? %>
    <div class="border-b border-gray-200 mb-6">
      <div class="flex space-x-4 overflow-x-auto" id="tabs-<%= category_slug %>">
        <button class="tab-button px-4 py-2 font-medium text-gray-600 hover:text-blue-600 border-b-2 border-blue-600 text-blue-600 whitespace-nowrap active" 
                data-category="<%= category_slug %>" 
                data-tab="all"
                onclick="switchTab('<%= category_slug %>', 'all', '<%= category.id %>')">
          Tất cả
        </button>
        <% subcategories.each do |subcat| %>
          <button class="tab-button px-4 py-2 font-medium text-gray-600 hover:text-blue-600 border-b-2 border-transparent whitespace-nowrap" 
                  data-category="<%= category_slug %>" 
                  data-tab="<%= subcat.slug %>"
                  onclick="switchTab('<%= category_slug %>', '<%= subcat.slug %>', '<%= subcat.id %>')">
            <%= subcat.name %>
          </button>
        <% end %>
      </div>
    </div>
  <% end %>

  <%# Product Grid - Keep height stable to avoid layout shift %>
  <div class="product-grid-<%= category_slug %> min-h-[400px]">
    <div id="products-<%= category_slug %>-all" class="tab-content active">
      <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-4 gap-6">
        <% products.each do |product| %>
          <%= render partial: 'product_card', locals: { product: product } %>
        <% end %>
        <% if products.empty? %>
          <div class="col-span-4 text-center text-gray-500 py-8">Chưa có sản phẩm</div>
        <% end %>
      </div>
    </div>

    <%# Tab content for each subcategory (loaded via AJAX) %>
    <% subcategories.each do |subcat| %>
      <div id="products-<%= category_slug %>-<%= subcat.slug %>" class="tab-content hidden">
        <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-4 gap-6">
          <div class="col-span-4 text-center text-gray-500 py-8">Đang tải...</div>
        </div>
      </div>
    <% end %>
  </div>
</section>

